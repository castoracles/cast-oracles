
import { ethers } from 'ethers';
import { CoreOracles } from 'core-oracles-sdk';

// BNB Chain Mainnet - Chainlink BNB/USD Address
const aggregatorV3InterfaceABI = [{ "inputs": [], "name": "latestRoundData", "outputs": [{ "internalType": "uint80", "name": "roundId", "type": "uint80" }, { "internalType": "int256", "name": "answer", "type": "int256" }, { "internalType": "uint256", "name": "startedAt", "type": "uint256" }, { "internalType": "uint256", "name": "updatedAt", "type": "uint256" }, { "internalType": "uint80", "name": "answeredInRound", "type": "uint80" }], "stateMutability": "view", "type": "function" }];
const addr = "0x0567F2323251f0A08a1b4E54InputData5923965"; // Example address, please verify for mainnet

// Setup provider for BNB Chain (using a public RPC URL)
const provider = new ethers.providers.JsonRpcProvider('https://bsc-dataseed.binance.org/');

async function getBnbPrice() {
    const priceFeed = new ethers.Contract(addr, aggregatorV3InterfaceABI, provider);
    const roundData = await priceFeed.latestRoundData();
    const price = parseFloat(ethers.utils.formatUnits(roundData.answer, 8)); // Price is typically 8 decimals
    console.log("Latest BNB/USD Price: $", price);
    
    // Now use this oracle to create a market
    const oracles = new CoreOracles({ network: 'bnb' }); // network: 'bnb' or 'bnbt' for testnet
    const market = await oracles.createMarket({
        question: `Will BNB/USD price be above $${(price + 10).toFixed(2)} tomorrow?`,
        description: 'Resolves based on Chainlink BNB/USD price feed.',
        category: 'CRYPTO',
        resolveBy: new Date(Date.now() + 24 * 60 * 60 * 1000).getTime(), // 24 hours from now
        oracle: {
            type: 'CHAINLINK',
            source: addr, // On-chain address of the price feed
        },
        initialLiquidity: 500,
    });
    console.log('Market created with Chainlink oracle:', market);
}

getBnbPrice();
    
